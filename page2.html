<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Fuel Efficiency Scatter Plot</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        svg {
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        circle {
            stroke: black;
        }
    </style>
</head>
<body onload="init()">
<svg width="50%" height="50%"></svg>
<script>
async function init() {
    // Load the data from the provided CSV file
    const data = await d3.csv('/mnt/data/cars2017 (1).csv', d => ({
        Make: d.Make,
        Fuel: d.Fuel,
        EngineCylinders: +d.EngineCylinders,
        AverageHighwayMPG: +d.AverageHighwayMPG,
        AverageCityMPG: +d.AverageCityMPG
    }));

    const width = parseInt(d3.select("svg").attr("width")),
          height = parseInt(d3.select("svg").attr("height")),
          margin = { top: 20, right: 20, bottom: 50, left: 50 },
          innerWidth = width - margin.left - margin.right,
          innerHeight = height - margin.top - margin.bottom;

    // Set up the scales with a logarithmic base 10 scale
    const xScale = d3.scaleLog()
        .domain([10, 150])
        .range([0, innerWidth]);

    const yScale = d3.scaleLog()
        .domain([10, 150])
        .range([innerHeight, 0]);

    // Set up the axes with the specified tick values and format
    const xAxis = d3.axisBottom(xScale)
        .tickValues([10, 20, 50, 100])
        .tickFormat(d3.format("~s"));

    const yAxis = d3.axisLeft(yScale)
        .tickValues([10, 20, 50, 100])
        .tickFormat(d3.format("~s"));

    const svg = d3.select("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform", `translate(${margin.left}, ${margin.top})`);

    // Append the circles for each data point
    svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("cx", d => xScale(d.AverageCityMPG))
        .attr("cy", d => yScale(d.AverageHighwayMPG))
        .attr("r", d => 2 + d.EngineCylinders)
        .attr("fill", d => {
            if (d.Fuel === 'electricity') return 'green';
            if (d.Fuel === 'diesel') return 'blue';
            if (d.Fuel === 'gasoline') return 'red';
            return 'gray'; // Default color if fuel type is unknown
        });

    // Append the x-axis
    svg.append("g")
        .attr("transform", `translate(0, ${innerHeight})`)
        .call(xAxis)
        .append("text")
        .attr("class", "axis-label")
        .attr("text-anchor", "middle")
        .attr("x", innerWidth / 2)
        .attr("y", 40)
        .text("Average City MPG");

    // Append the y-axis
    svg.append("g")
        .call(yAxis)
        .append("text")
        .attr("class", "axis-label")
        .attr("text-anchor", "middle")
        .attr("x", -innerHeight / 2)
        .attr("y", -40)
        .attr("transform", "rotate(-90)")
        .text("Average Highway MPG");
}
</script>
</body>
</html>
